version: "3"
services:
  eureka:
    image: jmc22071983/eureka-server:0.0.1-SNAPSHOT
    ports:
      - 8761
    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints: [node.hostname == manager1]
  airlines-service:
    image: jmc22071983/airlines-service:0.0.1-SNAPSHOT
    depends_on:
      - eureka
    deploy:
      mode: replicated
      replicas: 2
      placement:
        constraints: [node.hostname != manager1]
    ports:
      - 8098
    environment:
     eureka.client.serviceUrl.defaultZone: http://eureka:8761/eureka/ 
  airlines-service-client:
    image: jmc22071983/airlines-service-client:0.0.1-SNAPSHOT
    depends_on:
      - eureka
    deploy:
      mode: replicated
      replicas: 2
      placement:
        constraints: [node.hostname != manager1]
    ports:
      - 8099
    environment:
     eureka.client.serviceUrl.defaultZone: http://eureka:8761/eureka/ 
  couchbase:
    image: couchbase/server
    ports:
      - 8091:8091
      - 8092:8092
      - 8093:8093
      - 8094:8094
      - 11210:11210
    deploy:
      replicas: 1
      placement:
        constraints: [node.hostname == worker1]
  portainer:
    image: portainer/portainer:latest
    command: -H unix:///var/run/docker.sock
    ports:
      - "9000:9000"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data
    deploy:
      replicas: 1
      placement:
        constraints: [node.hostname == manager1]
  weblogic:
    image: ismaleiva90/weblogic12
    ports:
      - 7000
    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints: [node.hostname == manager1]

volumes:
  portainer_data: